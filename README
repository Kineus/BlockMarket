Deployed: https://block-market-sooty.vercel.app/
## Environment & Installation

1. `cp .env.example .env` then fill:
   - `RPC_URL_SEPOLIA` – Celo testnet RPC (e.g., https://forno.celo-testnet.org).
   - `PRIVATE_KEY` – deployer key (0x prefixed).
   - `CUSD_ADDRESS_SEPOLIA` – cUSD token on Celo testnet.
   - Frontend also uses `NEXT_PUBLIC_*` vars; keep them in sync post-deploy.
   - `NGROK_AUTH_TOKEN` (optional) for `npm run dev:ngrok`.

2. Install deps:

   npm install
   npm run install:frontend # optional helper: cd frontend && npm install

   ## Smart Contract Workflow

- Compile: `npx hardhat compile`
- Test locally: `npm test`
- Run local node (optional): `npx hardhat node`
- Deploy: `npx hardhat run --network celoSepolia scripts/deploy.js`
  - Save printed address.
  - Fund the contract with cUSD before user bets (simple ERC20 transfer).

## Sync ABI to Frontend

After compilation or deployment:
npm run generate-abi # copies the contract ABI into `frontend/config/abi.json`.

## Frontend

- Dev server: `npm run dev`
- Prod build: `npm run build && npm start`
- Tailwind configured with mobile-first styles.
- Connect button auto-hides inside MiniPay thanks to `window.ethereum?.isMiniPay`.
- Tx helper enforces `type: 'legacy'` + `feeCurrency = CUSD_ADDRESS` for MiniPay.

## Ngrok for MiniPay Testing

1. Ensure `NGROK_AUTH_TOKEN` is set.
2. `npm run dev:ngrok`: starts Next dev server and prints the secure tunnel URL for MiniPay’s “Load test app” feature.
3. Copy the URL into MiniPay’s Developer Mode page.

## MiniPay Developer Mode Steps

1. In MiniPay test build, enable `Settings → Advanced → Developer Mode`.
2. Paste ngrok URL into “Load Test App”.
3. MiniPay injects `window.ethereum` with `isMiniPay = true`, so the UI hides the connect button and directly calls viem legacy transactions.
4. Complete flows: approve cUSD, place bet, wait ≥1 block, settle.

## Placing & Settling Bets (User Flow)

1. Connect wallet (unless MiniPay detected).
2. View current block + predicted settle block.
3. Select EVEN or ODD using the large buttons.
4. Enter stake (e.g., 0.1 cUSD). Stake converts to wei client-side.
5. `Place Bet` triggers viem `writeContract` with `feeCurrency`.
6. Wait for the target block, then hit `Settle Bet`.
7. Result modal announces win/loss and payout (2x stake on win). Anyone can settle once the block is past target.

## Testing Expectations

- `npm test` runs:
  1. Bet placement transfers stake and stores data.
  2. Winning settlement pays 2× stake and emits event.
  3. Losing settlement leaves funds in contract.
- CI (GitHub Actions) runs the same on push.

## Dev Scripts

- `npm run start` – runs `next start` from frontend (after build).
- `npm run dev` – Next dev server.
- `npm run build` – Next build.
- `npm run test` – Hardhat tests.
- `npm run lint` – `next lint`.
- `npm run format` – Prettier across repo.
- `npm run deploy` – Hardhat deploy (Celo Sepolia).
- `npm run generate-abi` – Copies ABI to frontend.
- `npm run dev:ngrok` – Next dev + ngrok tunnel.

## MiniPay Notes

- `feeCurrency` must be set to cUSD; replace placeholder in `frontend/config/constants.js`.
- MiniPay currently supports only legacy (non-EIP-1559) tx; `sendLegacyTx` enforces `type: 'legacy'`.
- `ResultModal` shows friendly states; toast notifications show pending/success/error.

## Security & Gas Notes

- Solidity ^0.8.19 gives built-in overflow checks; no SafeMath import needed.
- All ERC20 transfers happen after state updates to deter reentrancy; comments note the precaution.
- `settleBet` restricts to post-target blocks, avoiding flash-bot griefing.
- `withdraw` is owner-only for manual test drains; remove before mainnet if unnecessary.

Happy hacking!
